{% extends 'shop/index.html' %}
{% load static %}
{% block css %}
    <link rel="stylesheet" href="{% static 'css/checkout.css' %}">
{% endblock css %}
{% block content %}
    <form class="checkout" method="POST">
        {% csrf_token %}
        <input id="blik" type="text" name="blik" placeholder="WprowadÅº kod" value="">
        <input id="verify" type="submit" value="Zweryfikuj">
    </form>
    <script type="text/javascript">
        const url = "/order_execute/"
        let code = blikGenerator();
        console.log(code);

        document.getElementById('verify').addEventListener('click', () => {
            verifyData();
        })

        function verifyData() {
            let blikValue = document.getElementById('blik').value;

            if (blikValue == code) {
                alert('Payment has been executed');
                fetch(url, {
                    method:'GET',
                    headers:{
                        'Content-Type': 'applicaiton/json',
                        'X-CSRFToken': csrftoken,
                    }
                }).then(() => location.href = '/products')
            }
        }

        function blikGenerator() {
            let code = "";

            function getRandomInt(min, max) {
                min = Math.ceil(min);
                max = Math.floor(max);
                return Math.floor(Math.random() * (max - min)) + min;
            }

            for (let i = 0; i < 4; i++) {
                code += getRandomInt(0, 9)
            }

            return code;
        }
    </script>
{% endblock content %}
